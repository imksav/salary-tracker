<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IMKSAV Salary Tracker â€” UK</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #e6f0ff, #f8fafc);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      padding: 28px;
    }

    .card {
      border-radius: 14px;
      box-shadow: 0 8px 26px rgba(34, 40, 80, 0.06);
    }

    .control {
      border-radius: 10px;
    }

    input[type="text"] {
      -moz-appearance: textfield;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .rate-badge {
      font-weight: 700;
      color: #0b5ed7;
    }

    .net-box {
      background: #e8f5e9;
      border-radius: 10px;
      padding: 10px;
      font-weight: 700;
      text-align: center;
    }

    .ded-box {
      background: #fff3cd;
      border-radius: 10px;
      padding: 8px;
      text-align: center;
    }

    .danger-small {
      color: #d9534f;
      font-weight: 600;
    }

    .muted-small {
      color: #6c757d;
      font-size: .9rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2 class="text-center mb-3 text-primary">IMKSAV Salary Tracker (UK)</h2>
    <p class="text-center muted-small mb-4">Enter weekly hours & optional payments â€” deductions calculated per the
      weekly logic (Personal allowance Â£241.70).</p>

    <div class="row gx-3 gy-3 mb-3">
      <div class="col-md-3">
        <label class="form-label">Basic Rate (Â£/hr)</label>
        <select id="defaultRate" class="form-select control">
          <option value="12.21">Â£12.21</option>
          <option value="12.75">Â£12.75</option>
          <option value="13.72">Â£13.72</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Quick Add: default hours</label>
        <input id="defaultHours" type="text" class="form-control control" value="37.5" />
      </div>

      <div class="col-md-6 d-flex align-items-end gap-2">
        <button class="btn btn-primary" onclick="addWeekFromDefaults()">âž• Add Week (quick)</button>
        <button class="btn btn-success" onclick="saveAll()">ðŸ’¾ Save</button>
        <button class="btn btn-info" onclick="exportExcel()">ðŸ“¤ Export Excel</button>
        <button class="btn btn-outline-secondary" onclick="clearAll()">ðŸ§¹ Clear All</button>
      </div>
    </div>

    <!-- Weeks list -->
    <div id="weeksList" class="row gy-4"></div>

    <footer class="text-center mt-4 muted-small">
      &copy; 2025 IMKSAV â€” Personal UK Salary Tracker
    </footer>
  </div>

  <script>
    const PERSONAL_ALLOWANCE_WEEKLY = 241.7;
    let weeksData = JSON.parse(localStorage.getItem('imksav_weeks')) || [];

    function num(val) {
      if (val === null || val === undefined) return 0;
      const n = parseFloat(String(val).replace(/[^0-9.\-]/g, ''));
      return Number.isFinite(n) ? n : 0;
    }

    function uid() { return 'id' + Date.now().toString(36) + Math.floor(Math.random() * 1000).toString(36); }

    function render() {
      const container = document.getElementById('weeksList');
      container.innerHTML = '';
      weeksData.forEach((w, idx) => {
        const col = document.createElement('div');
        col.className = 'col-md-6';
        col.innerHTML = weekCardHTML(w, idx + 1);
        container.appendChild(col);
        attachCardListeners(w.id);
      });
    }

    function weekCardHTML(w, displayIndex) {
      const basicRate = (w.rate || num(document.getElementById('defaultRate').value)).toFixed(2);
      const ot125Rate = ((w.rate || num(document.getElementById('defaultRate').value)) * 1.25).toFixed(2);
      const ot150Rate = ((w.rate || num(document.getElementById('defaultRate').value)) * 1.5).toFixed(2);

      const hours = num(w.hours);
      const ot125 = num(w.ot125);
      const ot150 = num(w.ot150);
      const holiday = num(w.holiday);
      const stepUp = num(w.stepUp);
      const ukp = num(w.ukp);

      const basicPay = hours * (w.rate || num(document.getElementById('defaultRate').value));
      const ot125Pay = ot125 * (w.rate || num(document.getElementById('defaultRate').value)) * 1.25;
      const ot150Pay = ot150 * (w.rate || num(document.getElementById('defaultRate').value)) * 1.5;
      const totalEarnings = basicPay + ot125Pay + ot150Pay + holiday + stepUp + ukp;

      const taxable = Math.max(totalEarnings - PERSONAL_ALLOWANCE_WEEKLY, 0);
      const tax = taxable * 0.2;
      const eeNI = taxable * 0.08;
      const totalDeductions = tax + eeNI;
      const net = totalEarnings - totalDeductions;

      return `
    <div class="card p-3" id="${w.id}-card">
      <div class="d-flex justify-content-between align-items-top mb-2">
        <div>
          <h5 class="mb-0">Week ${displayIndex}</h5>
          <div class="muted-small">Created: ${w.created || new Date().toLocaleString()}</div>
        </div>
        <div class="text-end">
          <div class="rate-badge">Rate: Â£${basicRate}/hr</div>
          <div class="muted-small">OT1.25: Â£${ot125Rate} | OT1.5: Â£${ot150Rate}</div>
          <button class="btn btn-sm btn-outline-danger mt-2" onclick="deleteWeek('${w.id}')">Delete</button>
        </div>
      </div>

      <div class="row g-2">
        <div class="col-6">
          <label class="form-label small">Hourly Rate (select)</label>
          <select class="form-select input-rate control" data-id="${w.id}">
            <option value="12.21" ${+w.rate === 12.21 ? 'selected' : ''}>Â£12.21</option>
            <option value="12.75" ${+w.rate === 12.75 ? 'selected' : ''}>Â£12.75</option>
            <option value="13.72" ${+w.rate === 13.72 ? 'selected' : ''}>Â£13.72</option>
          </select>
        </div>

        <div class="col-6">
          <label class="form-label small">Basic Hours</label>
          <input type="text" class="form-control input-hours control" data-id="${w.id}" value="${w.hours ?? ''}" placeholder="e.g. 37.5">
          <div class="muted-small">Pay: Â£<span id="${w.id}-basicPay">${basicPay.toFixed(2)}</span></div>
        </div>

        <div class="col-6">
          <label class="form-label small">OT 1.25 Hours</label>
          <input type="text" class="form-control input-ot125 control" data-id="${w.id}" value="${w.ot125 ?? ''}" placeholder="0">
          <div class="muted-small">Pay: Â£<span id="${w.id}-ot125Pay">${ot125Pay.toFixed(2)}</span></div>
        </div>

        <div class="col-6">
          <label class="form-label small">OT 1.50 Hours</label>
          <input type="text" class="form-control input-ot150 control" data-id="${w.id}" value="${w.ot150 ?? ''}" placeholder="0">
          <div class="muted-small">Pay: Â£<span id="${w.id}-ot150Pay">${ot150Pay.toFixed(2)}</span></div>
        </div>

        <div class="col-4">
          <label class="form-label small">Holiday (Â£) (optional)</label>
          <input type="text" class="form-control input-holiday control" data-id="${w.id}" value="${w.holiday ?? ''}" placeholder="0">
        </div>

        <div class="col-4">
          <label class="form-label small">Step Up (Â£) (optional)</label>
          <input type="text" class="form-control input-stepUp control" data-id="${w.id}" value="${w.stepUp ?? ''}" placeholder="0">
        </div>

        <div class="col-4">
          <label class="form-label small">UKP (Â£) (optional)</label>
          <input type="text" class="form-control input-ukp control" data-id="${w.id}" value="${w.ukp ?? ''}" placeholder="0">
        </div>

        <div class="col-6 mt-2">
          <div class="net-box">Gross: Â£<span id="${w.id}-gross">${totalEarnings.toFixed(2)}</span></div>
        </div>
        <div class="col-6 mt-2">
          <div class="ded-box">Deductions: Â£<span id="${w.id}-deductions">${totalDeductions.toFixed(2)}</span></div>
        </div>

        <div class="col-12 mt-2">
          <h5 class="text-primary">Net Pay: Â£<span id="${w.id}-net">${net.toFixed(2)}</span></h5>
          <div class="muted-small">Tax: Â£<span id="${w.id}-tax">${tax.toFixed(2)}</span> | EE NI: Â£<span id="${w.id}-eeNI">${eeNI.toFixed(2)}</span></div>
        </div>
      </div>
    </div>
  `;
    }

    function attachCardListeners(id) {
      const card = document.getElementById(id + '-card');
      if (!card) return;

      const sel = card.querySelector('.input-rate');
      const hours = card.querySelector('.input-hours');
      const ot125 = card.querySelector('.input-ot125');
      const ot150 = card.querySelector('.input-ot150');
      const holiday = card.querySelector('.input-holiday');
      const stepUp = card.querySelector('.input-stepUp');
      const ukp = card.querySelector('.input-ukp');

      const inputs = [sel, hours, ot125, ot150, holiday, stepUp, ukp];
      inputs.forEach(inp => {
        if (!inp) return;
        inp.addEventListener('input', () => {
          const obj = weeksData.find(x => x.id === id);
          if (!obj) return;
          obj.rate = num(card.querySelector('.input-rate').value);
          obj.hours = card.querySelector('.input-hours').value;
          obj.ot125 = card.querySelector('.input-ot125').value;
          obj.ot150 = card.querySelector('.input-ot150').value;
          obj.holiday = card.querySelector('.input-holiday').value;
          obj.stepUp = card.querySelector('.input-stepUp').value;
          obj.ukp = card.querySelector('.input-ukp').value;
          computeAndDisplay(obj);
        });
      });
    }

    function computeAndDisplay(entry) {
      const rate = num(entry.rate);
      const hours = num(entry.hours);
      const ot125 = num(entry.ot125);
      const ot150 = num(entry.ot150);
      const holiday = num(entry.holiday);
      const stepUp = num(entry.stepUp);
      const ukp = num(entry.ukp);

      const basicPay = hours * rate;
      const ot125Pay = ot125 * rate * 1.25;
      const ot150Pay = ot150 * rate * 1.5;
      const totalEarnings = basicPay + ot125Pay + ot150Pay + holiday + stepUp + ukp;

      const taxable = Math.max(totalEarnings - PERSONAL_ALLOWANCE_WEEKLY, 0);
      const tax = taxable * 0.2;
      const eeNI = taxable * 0.08;
      const totalDeductions = tax + eeNI;
      const netPay = totalEarnings - totalDeductions;

      entry.basicPay = basicPay;
      entry.ot125Pay = ot125Pay;
      entry.ot150Pay = ot150Pay;
      entry.totalEarnings = totalEarnings;
      entry.taxable = taxable;
      entry.tax = tax;
      entry.eeNI = eeNI;
      entry.totalDeductions = totalDeductions;
      entry.netPay = netPay;

      const id = entry.id;
      const el = document.getElementById(id + '-card');
      if (!el) return;
      el.querySelector(`#${id}-basicPay`).innerText = basicPay.toFixed(2);
      el.querySelector(`#${id}-ot125Pay`).innerText = ot125Pay.toFixed(2);
      el.querySelector(`#${id}-ot150Pay`).innerText = ot150Pay.toFixed(2);
      el.querySelector(`#${id}-gross`).innerText = totalEarnings.toFixed(2);
      el.querySelector(`#${id}-deductions`).innerText = totalDeductions.toFixed(2);
      el.querySelector(`#${id}-net`).innerText = netPay.toFixed(2);
      el.querySelector(`#${id}-tax`).innerText = tax.toFixed(2);
      el.querySelector(`#${id}-eeNI`).innerText = eeNI.toFixed(2);
    }

    function addWeek(data = {}) {
      const entry = {
        id: uid(),
        rate: num(data.rate) || num(document.getElementById('defaultRate').value),
        hours: data.hours ?? (data.hours === 0 ? 0 : ''),
        ot125: data.ot125 ?? (data.ot125 === 0 ? 0 : ''),
        ot150: data.ot150 ?? (data.ot150 === 0 ? 0 : ''),
        holiday: data.holiday ?? '',
        stepUp: data.stepUp ?? '',
        ukp: data.ukp ?? '',
        created: data.created || new Date().toLocaleString()
      };
      weeksData.push(entry);
      render();
      computeAndDisplay(entry);
    }

    function addWeekFromDefaults() {
      const rate = num(document.getElementById('defaultRate').value);
      const hours = num(document.getElementById('defaultHours').value);
      addWeek({ rate, hours });
    }

    function deleteWeek(id) {
      weeksData = weeksData.filter(w => w.id !== id);
      render();
    }

    function saveAll() {
      weeksData.forEach(w => computeAndDisplay(w));
      localStorage.setItem('imksav_weeks', JSON.stringify(weeksData));
      alert('Saved locally âœ…');
    }

    function exportExcel() {
      weeksData.forEach(w => computeAndDisplay(w));
      const sheetData = weeksData.map((w, idx) => ({
        Week: idx + 1,
        Created: w.created,
        'Rate(Â£/hr)': Number(w.rate).toFixed(2),
        'Basic Hours': num(w.hours),
        'Basic Pay(Â£)': Number(w.basicPay || 0).toFixed(2),
        'OT1.25 Hours': num(w.ot125),
        'OT1.25 Pay(Â£)': Number(w.ot125Pay || 0).toFixed(2),
        'OT1.5 Hours': num(w.ot150),
        'OT1.5 Pay(Â£)': Number(w.ot150Pay || 0).toFixed(2),
        'Holiday(Â£)': num(w.holiday),
        'StepUp(Â£)': num(w.stepUp),
        'UKP(Â£)': num(w.ukp),
        'Total Earnings(Â£)': Number(w.totalEarnings || 0).toFixed(2),
        'Personal Allowance(Â£)': PERSONAL_ALLOWANCE_WEEKLY,
        'Taxable(Â£)': Number(w.taxable || 0).toFixed(2),
        'Tax(Â£)': Number(w.tax || 0).toFixed(2),
        'EE NI(Â£)': Number(w.eeNI || 0).toFixed(2),
        'Total Deductions(Â£)': Number(w.totalDeductions || 0).toFixed(2),
        'Net Pay(Â£)': Number(w.netPay || 0).toFixed(2)
      }));

      const ws = XLSX.utils.json_to_sheet(sheetData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Salary');
      XLSX.writeFile(wb, 'imksav_salary_report.xlsx');
    }

    function clearAll() {
      if (!confirm('Clear all saved weeks?')) return;
      weeksData = [];
      localStorage.removeItem('imksav_weeks');
      render();
    }

    (function init() {
      const saved = JSON.parse(localStorage.getItem('imksav_weeks')) || [];
      if (Array.isArray(saved) && saved.length) {
        saved.forEach(s => { s.id = s.id || uid(); });
        weeksData = saved;
      } else {
        addWeek({ rate: num(document.getElementById ? document.getElementById('defaultRate').value : 12.21), hours: 37.5, created: new Date().toLocaleString() });
      }
      render();
    })();
  </script>
</body>

</html>